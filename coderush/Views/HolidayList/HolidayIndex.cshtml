@model List<CodesDotHRMS.Models.HolidayListViewModel>
@using Microsoft.AspNetCore.Identity
@using System.Globalization
@inject UserManager<ApplicationUser> _userManager

@{ ViewData["Title"] = "Holiday List";
    var user = await _userManager.GetUserAsync(User);
    var roles = await _userManager.GetRolesAsync(user);

}


<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            @ViewData["Title"]
        </h1>

    </section>

    @*<style>
        tr.group,
        tr.group:hover {
            background-color: #ddd !important;
        }
        </style>*@

    <style>
        table th, td, tr {
            border: 2px
        }

        table th, tr, td {
            background-color: #fff;
            border: 2px solid #888;
            font: 16px Helvetica, Arial;
            color: grey;
        }
    </style>

    <!-- Main content -->
    <section class="content">
        <!-- Default box -->
        <div class="box">
            <div class="box-header with-border">
                <h3 class="box-title">Holiday List</h3>
                <div>
                    <h4 class="text-center">CODESDOT HOLIDAY LIST @DateTime.Now.Year</h4>
                </div>
                <div class="box-tools pull-right">
                    @if (roles.Contains("SuperAdmin") || roles.Contains("HR"))
                    {
                        <a href="/HolidayList/Form" class="btn btn-primary"><i class="fa fa-plus"></i></a>

                    }
                </div>
            </div>
            <div class="box-body">
                <div class="table-responsive">
                    <table class="table table-striped display grid" cellspacing="0" width="100%">
                        <thead>
                            <tr>

                                <th width="20%">Date</th>
                                <th width="20%">Day</th>
                                <th width="20%">Name</th>
                                @if (roles.Contains("SuperAdmin") || roles.Contains("HR"))
                                {
                                    <th width="20%">Action</th>
                                }
                            </tr>
                        </thead>
                        <tbody>

                            @for (int i = 1; i <= 12; i++)
                            {

                                var data = Model.Where(x => x.Date.Value.Month == i).ToList();
                                if (data.Count > 0)
                                {
                                    if (i == 1)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">January</td></tr>
                                    }
                                    if (i == 2)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">February</td></tr>
                                    }
                                    if (i == 3)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">March</td></tr>
                                    }
                                    if (i == 4)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">April</td></tr>
                                    }
                                    if (i == 5)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">May</td></tr>
                                    }
                                    if (i == 6)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">June</td></tr>
                                    }
                                    if (i == 7)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">July</td></tr>
                                    }
                                    if (i == 8)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">August</td></tr>
                                    }
                                    if (i == 9)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">September</td></tr>
                                    }
                                    if (i == 10)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">October</td></tr>
                                    }
                                    if (i == 11)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">November</td></tr>
                                    }
                                    if (i == 12)
                                    {
                                        <tr><td colspan="4" align="center" style="font-weight:bold;">December</td></tr>
                                    }
                                    @*<tr><td>@i</td></tr>*@
                                    @foreach (var item in Model)
                                    {
                                        if (item.Date.Value.Month == @i)
                                        {
                                            <tr>
                                                <td>
                                                    @item.Date.Value.ToString("dd MMMM yyyy")
                                                </td>
                                                <td>
                                                    @item.Day
                                                </td>
                                                <td>
                                                    @item.Name
                                                </td>
                                                <td>
                                                    @if (roles.Contains("SuperAdmin") || roles.Contains("HR"))
                                                    {
                                                        <a href="/HolidayList/Delete/@item.Id"><i class="fa fa-trash"></i></a>

                                                    }
                                                </td>
                                            </tr>
                                        }

                                    }
                                }
                            }
                        </tbody>
                    </table>
                </div>

            </div>
            <!-- /.box-body -->
        </div>

        <!-- /.box -->
    </section>
    <!-- /.content -->
</div>
<!-- /.content-wrapper -->



@section Styles{
    <!-- DataTables -->
    <link rel="stylesheet" href="~/adminlte/components/datatables.net-bs/css/dataTables.bootstrap.min.css">
}


@section Scripts{


    <!-- DataTables -->
    <script src="~/adminlte/components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="~/adminlte/components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.11.5/sorting/date-dd-MMM-yyyy.js"></script>

    <!-- page script -->
    <script type="text/javascript">
        $(document).ready(function () {

            $('.grid').DataTable({
                lengthChange: false,
                info: false,
                searching: true,
                dom: 'lrtip',
                scrollX: false,
                pageLength: 25,
                columnDefs: [
                    { type: 'date-dd-mmm-yyyy', targets: 0 }
                ]
            });
        });

            //$(document).ready(function () {
            //    debugger
            //    var groupColumn = 2;
            //    var table = $('.grid').DataTable({
            //        "columnDefs": [
            //            { "visible": false, "targets": groupColumn }
            //        ],
            //        "order": [[groupColumn, 'asc']],
            //        "displayLength": 25,
            //        "drawCallback": function (settings) {
            //            var api = this.api();
            //            var rows = api.rows({ page: 'current' }).nodes();
            //            var last = null;

            //            api.column(groupColumn, { page: 'current' }).data().each(function (group, i) {
            //                if (last !== group) {
            //                    $(rows).eq(i).before(
            //                        '<tr class="group"><td colspan="4">' + group + '</td></tr>'
            //                    );

            //                    last = group;
            //                }
            //            });
            //        }
            //    });

            //    // Order by the grouping
            //    $('.grid tbody').on('click', 'tr.group', function () {
            //        var currentOrder = table.order()[0];
            //        if (currentOrder[0] === groupColumn && currentOrder[1] === 'asc') {
            //            table.order([groupColumn, 'desc']).draw();
            //        }
            //        else {
            //            table.order([groupColumn, 'asc']).draw();
            //        }
            //    });
            //});
    </script>

}

